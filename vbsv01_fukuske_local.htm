<!DOCTYPE HTML>
<html l10n="LOGON">
<head><meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title></title>
<link rel="icon" 		  href="../common/images/favicon.ico" type="image/ico" />
<link rel="shortcut icon" href="../common/images/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon-precomposed" href="../common/images/logo-apple-touch-icon-144.png" sizes="144x144">
<link rel="apple-touch-icon-precomposed" href="../common/images/logo-apple-touch-icon-114.png" sizes="114x114">
<link rel="apple-touch-icon-precomposed" href="../common/images/logo-apple-touch-icon-72.png"  sizes="72x72">
<meta name="msapplication-TileImage" content="../common/images/logo-win8-144.png"/>
<meta name="msapplication-TileColor" content="#ff0000"/>
<link href="../common/util/bootstrap/css/bootstrap.css" 					  rel="stylesheet">    
<link href="../common/util/bootstrap/css/bootstrap-responsive.css" 			  rel="stylesheet">
<link href="../common/util/bootstrap/css/commercial-templates.css" 			  rel="stylesheet">
<link href="../common/util/bootstrap/css/commercial-templates-responsive.css" rel="stylesheet">
<style>
@import url(../common/css/l10n-style.css);

@font-face {
  font-family: "Interstate-Light";
  src: url("../util/bootstrap/font/Interstate-Light-webfont.eot");
  src: url("../util/bootstrap/font/Interstate-Light-webfont.eot?#iefix") format("embedded-opentype"), url("../util/bootstrap/font/Interstate-Light-webfont.svg#InterstateExtraLight") format("svg");
}
.commercial-theme .tm-nav-banner .tm-container-fluid {
    padding: 0 24px;
}
.commercial-theme.tm-signin-standard,
.commercial-theme .tm-signin-standard,
.commercial-theme.tm-signin-complex,
.commercial-theme .tm-signin-complex {
	min-width: 970px \9;
	*min-width: 970px;
}
.commercial-theme .tm-alert.hide {
    display: none;
}
.commercial-theme .tm-navbar .tm-nav-banner .tm-brand img, .commercial-theme .tm-navbar .tm-nav-banner .tm-brand img + h3 {
    float: left;
    cursor: pointer;
}
.commercial-theme .tm-navbar .tm-nav-banner .tm-brand img {
    margin: 13px 8px 0 0;
}
.commercial-theme h3 {
    font-family: Interstate-Light;
    font-weight: 200;
    color: #222;
    font-size: 27px;
    line-height: 56px;
    margin: 0;
}
.commercial-theme h3 span {
    font-size: 70%;
    font-weight: normal;
    letter-spacing: -0.02em;
    color: #666;
    font-family: inherit;
    position: relative;
    right: -218px;
}
.commercial-theme .tm-footer .tm-container-fluid {
    padding: 0 24px;
}
.commercial-theme h3.osce-logo {
	background-image: url('../common/images/login-logo-osce.png');
	margin: 0;
	height: 60px;
	width: 450px;
}
</style>
</head>
<body class="commercial-theme tm-signin-standard ">
    <div class="tm-wrap">
		<div class="tm-navbar tm-navbar-static-top">
			<div class="tm-nav-banner">
				<div class="tm-container-fluid">
					<div class="tm-brand">
						<img src="../common/images/img_tball_red.png">
						<h3 class="osce-logo" rel="label_banner_tm"></h3>
					</div>
					<ul class="tm-navbar-links pull-right">
						<li><a href="#" class="l10n" rel="label_gethelp" id="link_support" target="_blank"></a></li>
					</ul>
				</div>
			</div>
		</div>
      	<div class="tm-container-fluid invisible" id="tm-login">
			<div class="tm-signin">
				<div class="tm-signin-content">
					<form name="form_login">
						<h4 class="l10n" rel="label_signin"></h4>
						<div class="tm-alert input-xlarge hide tm-msgbox">
							<button type="button" class="close" data-dismiss="alert">Ã—</button>
							<span class="tm-msg"></span>
						</div>
						<div class="tm-control-group" id="block-usernmae">
							<label for="labelUsername" class="l10n" rel="label_username"></label>
							<input type="text" class="input-xlarge login-info" id="labelUsername" 		name="username" placeholder="Type user name" maxlength="511" disabled>
							<span id="tip1stlogin" id="img_1stLoginPromptIcon" class="icon_tooltip hide" onmouseover="OSCE.util.tooltip(this, TIP_RBA_1STLOGON_TITLE, TIP_RBA_1STLOGON_CONTENT);"></span>
						</div>
						<div class="tm-control-group">
							<label for="labelPassword" class="l10n" rel="label_password"></label>
							<input type="password" class="input-xlarge login-info" id="labelPassword"  name="password" placeholder="Type password" disabled>
						</div>
						<div class="tm-control-group" id="block-domain">
							<label  for="labelDomain" class="l10n" rel="label_domain"></label>
							<select id="labelDomain" class="input-xlarge login-info" name="domainlist" disabled><option></option></select>
						</div>
						<div class="tm-control-group">
							<button class="tm-btn tm-btn-danger l10n login-info" type="button" rel="btn_signin" id="btn-signin"></button>
							<span class="tm-help-block agentinstaller">
								<span class="l10n" rel="label_provide_agent"></span>
								<a href="..\ClientInstall\WhichPlatform.htm" class="l10n" rel="label_installer" id="link_agentinstaller"></a>
							</span>  
						</div>
					</form>
				</div>
			</div>
		</div>
		<div class="tm-footer">
			<div class="tm-container-fluid">
				<span class="tm-footer-logo hidden-desktop" title="Trend Micro">
					<img src="../common/util/bootstrap/img/img_trend_small.png"/>
              	</span>
				<p class="copyright l10n" rel="label_copyright_tm"></p>
			</div>
		</div>
	</div>
<input type="hidden" id="IsRbaSupported" value="1">
<form name="form_logon" action="../cgi/cgiChkMasterPwd.exe" method="POST">
    <input type="hidden" name="TMlogonEncrypted" value=""> 
    <input type="hidden" name="TxtAccount" 		 value="">
</form>
<script type="text/javascript" src="../common/jquery/jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="../common/settings/setting.logon.js"></script> 
<script type="text/javascript" src="../common/util/common.js"></script>
<script type="text/javascript" src="../common/util/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../common/util/hashes.min.js"></script>
<script type="text/javascript" src="../common/l10n/l10n.global.js"></script>
<script type="text/javascript" src="../common/l10n/l10n.root.js"></script>
<script type="text/javascript" src="../common/l10n/settings.js"></script>
<script type="text/javascript">
$.ajax({ url: CGI_LIST['hostname'], dataType:'text' }).done(function(o){ document.title = o + " - " + L10N.GLOBAL.label_banner_tm.replace(/\<\/?span\>/g,' '); });
var getEl 		   = function(d){return document.getElementById(d);},
	ua  		   = navigator.userAgent.toLowerCase(),
	isX64 		   = (ua.indexOf('win64')>=0),
	supportedAX    = "ActiveXObject" in window,
	formLogin      = document.form_login,
	formLogon      = document.form_logon,
	xPassAllowed   = false,
	isRBASupported = getEl('IsRbaSupported').value,
    MD5            = new Hashes.MD5,
    SHA256         = new Hashes.SHA256,
	LANG           = OSCE.util.l10n();
	getEl('link_support').href = LANG.link_top_support;
	$('#tm-login').removeClass("invisible");
getEl('link_agentinstaller').href = CGI_LIST['web_install'];
var login = function(){
		if (formLogin.labelPassword.value == "") {
		    $(".tm-msgbox").css('display', 'block').find('.tm-msg').html(LANG.msg_type_admin_pwd);
		} 
		else {
        var strUserName = formLogin.username.value,
		    	strPwd = formLogin.labelPassword.value;
		    if ( (strUserName.indexOf("\\") == -1) && (strUserName.indexOf("@") == -1) ) {
		    		//Check if the domain list is selected
		    		var strDomain = formLogin.domainlist.options[formLogin.domainlist.selectedIndex].text;
		    		if (strDomain != "") {
		    			// AD user (User selects domain from the drop-down list
		    			strUserName = strDomain + "\\" + strUserName;        			
		    		} 
		    }
		    formLogin.labelPassword.value = formLogin.labelPassword.value.replace(/./g, '*');
            $.ajax({
                url: '../cgi/cgiChkMasterPwd.exe?id=0009', 
                dataType:'json',
                method: 'post'
            }).done(function(o){
                if ($('#labelDomain').val() == '' && (strUserName.indexOf("\\") == -1) && (strUserName.indexOf("@") == -1) ) {
                    formLogon.TMlogonEncrypted.value = SHA256.hex(MD5.hex(strPwd) + o.LoginTicket);
                    formLogon.TxtAccount.value = strUserName;
                    formLogon.submit();
                } else {
                    // AD user will not use AES256
                    formLogon.TMlogonEncrypted.value = strPwd;
                    formLogon.TxtAccount.value = strUserName;
                    formLogon.submit();
                }
            });
		}
	},
	pressEnter = function(e){
		if(e.keyCode == 13){
			login();
		}
	};
var setFocus = function(){
		if (formLogin.username.disabled == false) {
			formLogin.username.focus();
			formLogin.username.select();
		}
	},
	showMsg = function(msg){
		document.cookie = "serror=0";
		setFocus();
		$(".tm-msgbox").css('display', 'block').find('.tm-msg').html(msg);
	},
	Logon_Fail = function(){
		showMsg(LANG.msg_unable_logon);
	},
	Logon_FaileNoPermission = function(){
		showMsg(LANG.msg_unable_logon);
	},
	Logon_FaileWrongProxyAccount = function(){
		showMsg(LANG.msg_unable_logon_wrong_proxy);
	},
	Logon_FailDisabledNativeUser = function(){
		showMsg(LANG.msg_unable_logon_disabled_user);
	},
	Logon_FailDisabledADUser = function(){
		showMsg(LANG.msg_unable_logon_disabled_aduser);
	},
	Logon_FaileUserNotImported = function(){
		showMsg(LANG.msg_unable_logon_not_import_user);
	},
	Logon_RootPrompt = function(){
		document.getElementById('img_1stLoginPromptIcon').style.display = "";
	},
	Service_Stopped = function(){
		showMsg(LANG.msg_osce_service_stopped);
	},
	Service_Stopped_SQLOutage = function(){
		showMsg(LANG.msg_sqlserver_is_unavailable);
	},
	checkUser = function(){
		var username = formLogin.username.value;
		if((username.indexOf("\\") != -1) || (username.indexOf("@") != -1)){
	  		if (formLogin.domainlist.options.length > 1){
	  			formLogin.domainlist.selectedIndex = 0;
	  			formLogin.domainlist.disabled = true;
			}
		}
		else {
	  		if (formLogin.domainlist.options.length > 1 && formLogin.domainlist.disabled == true){
	  			// There's domains in drop-down list, enable it.
	  			formLogin.domainlist.disabled = false;
	  		}
	  	}
	},
	resetSessionCookie = function(){
		document.cookie = "session=;path=/officescan;";
		document.cookie = "key=;path=/officescan;";
		document.cookie = "stamp=;path=/officescan;";
	},
	checkCookieSupporting = function(){
		document.cookie = "testCookie=Test;path=/officescan;";
		var arr_cookie = document.cookie;
		// Delete testCookie
	    var expires = new Date();
	    expires.setTime(expires.getTime() - 1); 
	    document.cookie = "testCookie=Test;path=/officescan;" + "expires=" + expires.toGMTString();
		if (arr_cookie.length == 0){
			window.location.href = "/officescan/console/html/root/NotSupportCookie.htm";
		}
	},
	checkSessionExpiring = function(){
		if (document.cookie.indexOf("session_expired=yes") != -1) {
			$(".tm-msgbox").css('display', 'block').find('.tm-msg').html(LANG.msg_session_expired);
			resetSessionCookie();
		}
		else if (document.cookie.indexOf("session_expired=logoff") != -1) {
			resetSessionCookie();
		}
		document.cookie = "session_expired=no; path=/officescan;";
	},
	checkBrowserSupporting = function(){
		var ltIE10  = false;
		if($.browser['msie']){
			ltIE10 = parseInt($.browser['version'],10)<10;
		}
		if(ltIE10){
			$(".tm-msgbox").css('display', 'block').find('.tm-msg').html(LANG.msg_support_ie_above);
			$('.login-info').attr('disabled', true);
		}
		else {
			$('.login-info').attr('disabled', false);
			$('#username').on('keyup',  checkUser);
			$('#btn-signin').on('click',login);
			$('#labelPassword').on('keydown', pressEnter);
			$('#labelDomain').on('keydown',	pressEnter);
		}
	};
(function(){
    $("#labelUsername").attr("placeholder", LANG.label_placeholder_username);
    $("#labelPassword").attr("placeholder", LANG.label_placeholder_password);
	checkCookieSupporting();
	checkBrowserSupporting();
	checkSessionExpiring();
	if (isRBASupported == 0) {
        console.log(isRBASupported);
	    getEl('block-usernmae').style.display = "none";
	    formLogin.username.disabled = true;
	    getEl('block-domain').style.display = "none";
	    formLogin.domainlist.disabled = true;
	} 
	else {
        if (formLogin.domainlist.options.length == 1) {
            // There's no domains in the list, hide the drop down list
            getEl('block-domain').style.display = "none";
            formLogin.domainlist.disabled = true;
        }
	}
	setFocus();
})();

function NewWindow( mypage, myname, w, h, scroll){
	var pos_left = (screen.width) ? (screen.width-w)/2 : 0;
	var pos_top  = (screen.height) ? (screen.height-h)/2 : 0;
	var settings = 'height='+h+',width='+w+',top='+pos_top+',left='+pos_left+',scrollbars='+scroll+',resizable';
		win		 = window.open(mypage,myname,settings);
}

function MM_goToURL() { //v3.0
  var i, args=MM_goToURL.arguments; document.MM_returnValue = false;
  for (i=0; i<(args.length-1); i+=2) eval(args[i]+".location='"+args[i+1]+"'");
}

function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}
</script>
</body>
</html>
